<div class="w-full max-w-350 mx-auto px-4 py-6 md:py-8 space-y-5 md:space-y-6">

    <!-- ── Search Bar ────────────────────────────────────────────────────── -->
    <div class="flex justify-center sticky top-4 z-20">
        <div class="w-full max-w-xl bg-white rounded-2xl p-1 border border-neutral/10 chat-box-shadow flex items-center gap-2 transition-all duration-300
                focus-within:border-primary/60 focus-within:shadow-[0_0_0_3px_rgba(60,110,113,0.12)]">
            <div class="flex-1 flex items-center px-3 md:px-4">
                <input type="text" [(ngModel)]="searchQuery" placeholder="Search your videos ..."
                    class="w-full py-1.5 md:py-2 bg-transparent border-none focus:ring-0 text-sm md:text-base text-dark placeholder:text-neutral/60 transition-all duration-300" />
            </div>
            <button
                class="bg-primary text-white w-9 h-9 md:w-10 md:h-10 rounded-xl hover:bg-primary/90 transition-all flex items-center justify-center shrink-0">
                <mat-icon class="leading-none"
                    style="font-size:18px;width:18px;height:18px;display:flex;align-items:center;justify-content:center;">search</mat-icon>
            </button>
        </div>
    </div>

    <!-- ── Filters Bar ───────────────────────────────────────────────────── -->
    <!-- .filter-bar class is used by HostListener to detect outside clicks -->
    <div class="filter-bar bg-neutral/5 p-3 md:p-4 rounded-2xl border border-neutral/10">
        <div class="grid grid-cols-2 gap-2 md:flex md:items-center md:gap-3">

            <!-- Platform -->
            <div class="relative">
                <button
                    (click)="isPlatformDropdownOpen.set(!isPlatformDropdownOpen()); isSortDropdownOpen.set(false); isTypeDropdownOpen.set(false)"
                    class="w-full flex items-center justify-between gap-1.5 px-3 py-2 bg-white border border-neutral/15 rounded-xl text-[10px] md:text-xs font-medium text-dark hover:border-primary/50 transition-all">
                    <div class="flex items-center gap-1.5 min-w-0">
                        <mat-icon class="text-primary shrink-0"
                            style="font-size:14px;width:14px;height:14px;">apps</mat-icon>
                        <span class="truncate">{{ selectedPlatform() }}</span>
                    </div>
                    <mat-icon class="text-neutral shrink-0"
                        style="font-size:14px;width:14px;height:14px;">expand_more</mat-icon>
                </button>
                @if (isPlatformDropdownOpen()) {
                <div
                    class="absolute top-full left-0 mt-1.5 w-44 bg-white border border-neutral/15 rounded-xl shadow-xl z-50 py-1 overflow-hidden">
                    @for (p of platforms; track p) {
                    <button (click)="selectPlatform(p)"
                        class="w-full text-left px-4 py-2 text-xs hover:bg-neutral/5 transition-colors"
                        [class.text-primary]="selectedPlatform() === p" [class.font-bold]="selectedPlatform() === p">{{
                        p }}</button>
                    }
                </div>
                }
            </div>

            <!-- Type -->
            <div class="relative">
                <button
                    (click)="isTypeDropdownOpen.set(!isTypeDropdownOpen()); isPlatformDropdownOpen.set(false); isSortDropdownOpen.set(false)"
                    class="w-full flex items-center justify-between gap-1.5 px-3 py-2 bg-white border border-neutral/15 rounded-xl text-[10px] md:text-xs font-medium text-dark hover:border-primary/50 transition-all">
                    <div class="flex items-center gap-1.5 min-w-0">
                        <mat-icon class="text-primary shrink-0"
                            style="font-size:14px;width:14px;height:14px;">movie</mat-icon>
                        <span class="truncate">{{ selectedType() }}</span>
                    </div>
                    <mat-icon class="text-neutral shrink-0"
                        style="font-size:14px;width:14px;height:14px;">expand_more</mat-icon>
                </button>
                @if (isTypeDropdownOpen()) {
                <div
                    class="absolute top-full left-0 mt-1.5 w-36 bg-white border border-neutral/15 rounded-xl shadow-xl z-50 py-1 overflow-hidden">
                    @for (t of typeOptions; track t) {
                    <button (click)="selectType(t)"
                        class="w-full text-left px-4 py-2 text-xs hover:bg-neutral/5 transition-colors"
                        [class.text-primary]="selectedType() === t" [class.font-bold]="selectedType() === t">{{ t
                        }}</button>
                    }
                </div>
                }
            </div>

            <!-- Sort -->
            <div class="relative">
                <button
                    (click)="isSortDropdownOpen.set(!isSortDropdownOpen()); isPlatformDropdownOpen.set(false); isTypeDropdownOpen.set(false)"
                    class="w-full flex items-center justify-between gap-1.5 px-3 py-2 bg-white border border-neutral/15 rounded-xl text-[10px] md:text-xs font-medium text-dark hover:border-primary/50 transition-all">
                    <div class="flex items-center gap-1.5 min-w-0">
                        <mat-icon class="text-primary shrink-0"
                            style="font-size:14px;width:14px;height:14px;">sort</mat-icon>
                        <span class="truncate">{{ selectedSort() }}</span>
                    </div>
                    <mat-icon class="text-neutral shrink-0"
                        style="font-size:14px;width:14px;height:14px;">expand_more</mat-icon>
                </button>
                @if (isSortDropdownOpen()) {
                <div
                    class="absolute top-full left-0 mt-1.5 w-36 bg-white border border-neutral/15 rounded-xl shadow-xl z-50 py-1 overflow-hidden">
                    @for (s of sortOptions; track s) {
                    <button (click)="selectSort(s)"
                        class="w-full text-left px-4 py-2 text-xs hover:bg-neutral/5 transition-colors"
                        [class.text-primary]="selectedSort() === s" [class.font-bold]="selectedSort() === s">{{ s
                        }}</button>
                    }
                </div>
                }
            </div>

            <!-- Favorites — right on desktop, bottom-right on mobile -->
            <button (click)="showFavoritesOnly.set(!showFavoritesOnly())"
                class="md:ml-auto flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-[10px] md:text-xs font-medium transition-all border"
                [class.bg-primary]="showFavoritesOnly()" [class.text-white]="showFavoritesOnly()"
                [class.border-primary]="showFavoritesOnly()" [class.bg-white]="!showFavoritesOnly()"
                [class.text-dark]="!showFavoritesOnly()" [class.border-neutral/15]="!showFavoritesOnly()">
                <mat-icon style="font-size:14px;width:14px;height:14px;" [class.text-white]="showFavoritesOnly()"
                    [class.text-primary]="!showFavoritesOnly()">{{ showFavoritesOnly() ? 'favorite' : 'favorite_border'
                    }}</mat-icon>
                <span>Favorites</span>
            </button>

        </div>
    </div>

    <!-- ── Video Grid ─────────────────────────────────────────────────────── -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-5"
        style="min-height: 320px;">
        @for (video of filteredVideos(); track video.id) {
        <div class="bg-white rounded-2xl overflow-hidden border border-neutral/10 shadow-sm transition-all">

            <!-- Thumbnail -->
            <div class="aspect-video relative overflow-hidden">
                <img (click)="openVideo(video)" [src]="video.thumbnail" [alt]="video.title"
                    class="w-full h-full object-cover" />

                <!-- Type badge — preserved exactly as original -->


                <!-- Favorite button -->
                <button (click)="toggleFavorite(video.id)"
                    class="absolute top-2 right-2 w-7 h-7 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center shadow-lg transition-all active:scale-90">
                    <mat-icon style="font-size:14px;width:14px;height:14px;" [class.text-red-500]="video.isFavorite"
                        [class.text-neutral]="!video.isFavorite">{{ video.isFavorite ? 'favorite' : 'favorite_border'
                        }}</mat-icon>
                </button>
            </div>

            <!-- Card Content -->
            <div class="p-3 md:p-4 space-y-2 md:space-y-3">
                <div class="space-y-1 text-center">
                    <h3 class="text-xs md:text-sm font-bold text-dark line-clamp-2 leading-tight min-h-10">
                        {{ video.title }}
                    </h3>
                    <span
                        class="inline-block text-[9px] md:text-[10px] px-2 py-0.5 bg-primary/10 text-primary rounded-full font-bold uppercase tracking-wider">
                        {{ video.platform }}
                    </span>
                </div>

                <div class="flex items-center justify-between text-[9px] md:text-[10px] text-neutral font-medium">
                    <div class="flex items-center gap-2 md:gap-3">

                        <div class="flex items-center gap-0.5">
                            <mat-icon style="font-size:15px;width:15px;height:15px;">
                                {{ video.type === 'Video' ? 'play_circle' : 'headset' }}
                            </mat-icon>
                        </div>
                        <div class="flex items-center gap-0.5">
                            <mat-icon style="font-size:10px;width:10px;height:10px;">visibility</mat-icon>
                            <span>{{ video.views }}</span>
                        </div>
                        <div class="flex items-center gap-0.5">
                            <mat-icon style="font-size:10px;width:10px;height:10px;">thumb_up</mat-icon>
                            <span>{{ video.likes }}</span>
                        </div>

                    </div>
                    <span>{{ video.downloadDate | date:'MMM d, y' }}</span>
                </div>

                <div class="pt-2 md:pt-3 border-t border-neutral/5 flex gap-2">
                    <!-- Open Video → triggers modal -->
                    <button (click)="openVideo(video)"
                        class="flex-1 py-1.5 md:py-2 bg-neutral/5 hover:bg-neutral/10 rounded-xl text-[9px] md:text-[10px] font-bold text-dark transition-colors">
                        Open Video
                    </button>
                    <button
                        class="flex-1 py-1.5 md:py-2 bg-primary/10 hover:bg-primary/20 rounded-xl text-[9px] md:text-[10px] font-bold text-primary transition-colors">
                        Download
                    </button>
                </div>
            </div>
        </div>

        } @empty {
        <div class="col-span-full py-16 md:py-20 flex flex-col items-center justify-center text-center space-y-4">
            <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-neutral/5 flex items-center justify-center">
                <mat-icon class="text-neutral" style="font-size:36px;width:36px;height:36px;">search_off</mat-icon>
            </div>
            <div class="space-y-1">
                <h3 class="text-base md:text-lg font-bold text-dark">No videos found</h3>
                <p class="text-xs md:text-sm text-neutral">Try adjusting your search or filters</p>
            </div>
            <button
                (click)="searchQuery.set(''); selectedPlatform.set('All Platforms'); selectedType.set('All Types'); showFavoritesOnly.set(false)"
                class="text-primary font-bold text-xs md:text-sm hover:underline">
                Clear all filters
            </button>
        </div>
        }
    </div>

</div>

<!-- ═══════════════════════════════════════════════════════════════════════
     VIDEO DETAIL MODAL
     Blurred overlay — click .modal-overlay to close, or press the X button.
════════════════════════════════════════════════════════════════════════════ -->
@if (selectedVideo()) {
<div class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4 md:p-8"
    style="background: rgba(0,0,0,0.55); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);"
    (click)="onOverlayClick($event)">
    <!-- Modal Panel -->
    <div class="bg-white rounded-3xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl relative flex flex-col">

        <!-- Close button -->
        <button (click)="closeModal()"
            class="absolute top-4 right-4 z-10 w-9 h-9 rounded-full bg-neutral/30 hover:bg-neutral/50 flex items-center justify-center transition-colors">
            <mat-icon style="font-size:18px;width:18px;height:18px;" class="text-dark">close</mat-icon>
        </button>

        <!-- Thumbnail -->
        <div class="aspect-video w-full overflow-hidden rounded-t-3xl relative shrink-0">
            <img [src]="selectedVideo()!.thumbnail" [alt]="selectedVideo()!.title" class="w-full h-full object-cover" />
            <!-- Type badge -->
            <div
                class="absolute top-3 left-3 bg-black/60 backdrop-blur-md px-2 py-1 rounded-lg flex items-center gap-1.5 text-slate-50">
                <mat-icon style="font-size:12px;width:12px;height:12px;">
                    {{ selectedVideo()!.type === 'Video' ? 'play_circle' : 'headset' }}
                </mat-icon>
                <span class="text-[10px] font-bold uppercase tracking-wider">{{ selectedVideo()!.type }}</span>
            </div>
        </div>

        <!-- Modal Body -->
        <div class="px-6 py-5 space-y-5">

            <!-- Title + Platform -->
            <div class="space-y-2">
                <h2 class="text-lg md:text-xl font-display font-bold text-dark leading-snug pr-8">
                    {{ selectedVideo()!.title }}
                </h2>
                <div class="flex items-center gap-2">
                    <span
                        class="text-[10px] px-2.5 py-1 bg-primary/10 text-primary rounded-full font-bold uppercase tracking-wider">
                        {{ selectedVideo()!.platform }}
                    </span>
                    <span class="text-[10px] text-neutral font-medium">
                        Downloaded {{ selectedVideo()!.downloadDate | date:'MMM d, yyyy' }}
                    </span>
                </div>
            </div>

            <!-- Description -->
            <p class="text-sm text-dark/70 leading-relaxed">
                {{ selectedVideo()!.description }}
            </p>

         <!-- Stats row -->
<div class="grid grid-cols-3 gap-2 sm:gap-3">

    <div class="bg-neutral/5 rounded-xl sm:rounded-2xl 
                p-2 sm:p-3 
                flex flex-col items-center gap-0.5 sm:gap-1">

        <mat-icon class="text-primary text-sm sm:text-base w-4 h-4 sm:w-5 sm:h-5">
            visibility
        </mat-icon>

        <span class="text-[11px] sm:text-sm font-bold text-dark">
            {{ selectedVideo()!.views }}
        </span>

        <span class="text-[8px] sm:text-[9px] 
                     text-neutral font-medium 
                     uppercase tracking-wide">
            Views
        </span>
    </div>

    <div class="bg-neutral/5 rounded-xl sm:rounded-2xl 
                p-2 sm:p-3 
                flex flex-col items-center gap-0.5 sm:gap-1">

        <mat-icon class="text-primary text-sm sm:text-base w-4 h-4 sm:w-5 sm:h-5">
            thumb_up
        </mat-icon>

        <span class="text-[11px] sm:text-sm font-bold text-dark">
            {{ selectedVideo()!.likes }}
        </span>

        <span class="text-[8px] sm:text-[9px] 
                     text-neutral font-medium 
                     uppercase tracking-wide">
            Likes
        </span>
    </div>

    <div class="bg-neutral/5 rounded-xl sm:rounded-2xl 
                p-2 sm:p-3 
                flex flex-col items-center gap-0.5 sm:gap-1">

        <mat-icon class="text-primary text-sm sm:text-base w-4 h-4 sm:w-5 sm:h-5">
            chat_bubble
        </mat-icon>

        <span class="text-[11px] sm:text-sm font-bold text-dark">
            {{ selectedVideo()!.comments }}
        </span>

        <span class="text-[8px] sm:text-[9px] 
                     text-neutral font-medium 
                     uppercase tracking-wide">
            Comments
        </span>
    </div>

</div>


<!-- Action buttons -->
<div class="flex gap-2 pt-1">

    <button (click)="toggleFavorite(selectedVideo()!.id)"
        class="flex items-center gap-1 
               px-2.5 sm:px-4 
               py-1.5 sm:py-2.5 
               rounded-lg sm:rounded-2xl 
               border transition-colors 
               text-[11px] sm:text-sm 
               font-semibold"

        [class.bg-red-50]="selectedVideo()!.isFavorite"
        [class.border-red-200]="selectedVideo()!.isFavorite"
        [class.text-red-500]="selectedVideo()!.isFavorite"
        [class.bg-neutral/5]="!selectedVideo()!.isFavorite"
        [class.border-neutral/20]="!selectedVideo()!.isFavorite"
        [class.text-dark]="!selectedVideo()!.isFavorite">

        <mat-icon class="text-xs sm:text-base w-3 h-3 sm:w-4 sm:h-4">
            {{ selectedVideo()!.isFavorite ? 'favorite' : 'favorite_border' }}
        </mat-icon>

        {{ selectedVideo()!.isFavorite ? 'Added to Favorites' : 'Add to Favorites' }}
    </button>

    <button
        class="flex-1 
               py-1.5 sm:py-2.5 
               bg-primary hover:bg-primary/90 
               text-white 
               rounded-lg sm:rounded-2xl 
               text-[11px] sm:text-sm 
               font-bold 
               transition-colors 
               flex items-center justify-center gap-1">

        <mat-icon class="text-xs sm:text-base w-3 h-3 sm:w-4 sm:h-4">
            download
        </mat-icon>

        Download
    </button>

</div>

        </div>
    </div>
</div>
}